#include "WebPage.h"

IPAddress local_ip  (192, 168, 1, 1);
IPAddress gateway   (192, 168, 1, 1);
IPAddress subnet    (255, 255, 255, 0);
WebServer server(80);

void webPage_init() {
    WiFi.softAPConfig(local_ip, gateway, subnet);
    delay(100);
    webPage_setupRoutes();
    Serial.println("routes Initialised");
    server.begin();
    Serial.println("HTTP Server Started");
}

void webPage_setupRoutes(){
    server.on("/", handle_root);
    server.on("/state", handle_stateUpdate);
    server.on("/eStop/on", handle_eStop_on);
    server.on("/debug/on", handle_debug_on);
    server.on("/debug/off", handle_debug_off);
    server.on("/switchState", handle_switchState);
    server.on("/activateBridge/raise", handle_activateBridge_raise);
    server.on("/activateBridge/lower", handle_activateBridge_lower);
}

//Routes
void handle_root(){ server.send(200, "text/html", createHTML()); }
void handle_stateUpdate(){
    String json = "{";

    json += "}";
    server.send(200, "application/json", json);
}
void handle_eStop_on(){
    //state variable change
    //other gpio stuff
    Serial.println("ESTOP Status : ON");
    server.send(200, "text/html" ,createHTML());
}
void handle_eStop_off(){
    //state variable change
    //other gpio stuff
    Serial.println("ESTOP Status : OFF");
    server.send(200, "text/html" ,createHTML());
}
void handle_debug_on(){
    //state variable change
    //other gpio stuff
    Serial.println("DEBUG Status : ON");
    server.send(200, "text/html" ,createHTML());
}
void handle_debug_off(){
    //state variable change
    //other gpio stuff
    Serial.println("DEBUG Status : OFF");
    server.send(200, "text/html" ,createHTML());
}
void handle_switchState(){
    //state variable change
    //other gpio stuff
    Serial.print("SWITCHED TO NEXT STATE : ");
    // Serial.print(bridgeState++);
    // Serial.print(stateMachine.getKey(bridgeState));
    server.send(200, "text/html" ,createHTML());
}
void handle_activateBridge_raise(){
    //state variable change
    //other gpio stuff
    Serial.println("ACTIVATE BRIDGE Status : RAISE");
    server.send(200, "text/html" ,createHTML());
}
void handle_activateBridge_lower(){
    //state variable change
    //other gpio stuff
    Serial.println("ACTIVATE BRIDGE Status : LOWER");
    server.send(200, "text/html" ,createHTML());
}

// Auto-generated by Convert on 2025-10-15 12:33:13

String createHTML() {
    String str = "";
    str += "<!DOCTYPE html>\n";
    str += "<html lang=\"en\">\n";
    str += "<head>\n";
    str += "    <meta charset=\"utf-8\"/>\n";
    str += "    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\"/>\n";
    str += "    <title> MidSem WA8 Control Panel </title>\n";
    str += "    <style>\n";
    str += "        :root{\n";
    str += "            --borderwidth: 0px;\n";
    str += "            --buttonRegOn: green;\n";
    str += "            --buttonRegOff: red;\n";
    str += "            --trafficRedOn:#ff2b2b;\n";
    str += "            --trafficRedOff: #3a0d0d;\n";
    str += "            --trafficRedGlow: rgba(255, 40, 40, 0.65);\n";
    str += "            --trafficYellowOn: #ffd400;\n";
    str += "            --trafficYellowOff: #3a3200;\n";
    str += "            --trafficYellowGlow: rgba(255, 212, 0, 0.55);\n";
    str += "            --trafficGreenOn: #1eea5a;\n";
    str += "            --trafficGreenOff: #0e2a1a;\n";
    str += "            --trafficGreenGlow: rgba(30, 234, 90, 0.55);\n";
    str += "            --trafficHousing: #111;\n";
    str += "            --trafficBezel: #000;\n";
    str += "            --estopOn:red;\n";
    str += "            --estopOff:darkRed;\n";
    str += "            --headFoot: calc(100% - (var(--borderwidth)*2));\n";
    str += "            --showTag: true;\n";
    str += "            --backLight:#282f3e;\n";
    str += "            --backMid :#1e232f;\n";
    str += "            --backDarkMid :#14171f;\n";
    str += "            --backDark:#0f1115;\n";
    str += "            --stateDefault: #2e384d;\n";
    str += "            --textColourDefault: #999;\n";
    str += "            --titleColour: #dfdede;\n";
    str += "        }\n";
    str += "        a {\n";
    str += "            color:red;\n";
    str += "        }\n";
    str += "        * {\n";
    str += "            margin: 5px;\n";
    str += "        }\n";
    str += "        body {\n";
    str += "            border: var(--borderwidth) solid black;\n";
    str += "            display:flex; \n";
    str += "            font-family: Arial, Helvetica, sans-serif;\n";
    str += "            color:#ebebeb;\n";
    str += "            text-align: center;\n";
    str += "            flex-direction: column;\n";
    str += "            min-width: min-content;\n";
    str += "            width:100%;\n";
    str += "            align-items:center;\n";
    str += "            background:linear-gradient(var(--backMid), var(--backLight),var(--backMid), var(--backDark));\n";
    str += "        }\n";
    str += "        header{\n";
    str += "            border: var(--borderwidth) solid red;\n";
    str += "            width: var(--headFoot);\n";
    str += "            display: flex;\n";
    str += "            flex-direction: row;\n";
    str += "            align-items: center;\n";
    str += "            justify-content: space-evenly;\n";
    str += "        }\n";
    str += "        h1, h2{\n";
    str += "            color: var(--titleColour);\n";
    str += "        }\n";
    str += "        h3, h4, h5, label{\n";
    str += "            color:var(--textColourDefault);\n";
    str += "        }\n";
    str += "        .debug{\n";
    str += "            border: var(--borderwidth) solid blue;\n";
    str += "            justify-self: flex-end;\n";
    str += "        }\n";
    str += "        .title{\n";
    str += "            border: var(--borderwidth) solid black;\n";
    str += "            display: flex;\n";
    str += "            justify-self: center;\n";
    str += "            flex-direction: column;\n";
    str += "        }\n";
    str += "        main{\n";
    str += "            border: var(--borderwidth) solid green;\n";
    str += "            display:flex;\n";
    str += "            flex-direction: row;\n";
    str += "            justify-content: space-evenly;\n";
    str += "            align-items: stretch;\n";
    str += "            align-content: center;\n";
    str += "            height:100%;\n";
    str += "        }\n";
    str += "        .sideBar{\n";
    str += "            background-color: var(--backDark);\n";
    str += "            border: var(--borderwidth) solid blue;\n";
    str += "            border-radius: 16px;\n";
    str += "            display:flex;\n";
    str += "            flex-direction: column;\n";
    str += "            flex-wrap: wrap;\n";
    str += "            justify-content: center;\n";
    str += "            align-items: center;\n";
    str += "            align-content: center;\n";
    str += "            justify-self: flex-start;\n";
    str += "            align-self: stretch;\n";
    str += "        }\n";
    str += "        .mainBlock{\n";
    str += "            border: var(--borderwidth) solid yellow;\n";
    str += "            background-color: var(--backDark);\n";
    str += "            border-radius: 16px;\n";
    str += "            display:flex;\n";
    str += "            flex-direction: column;\n";
    str += "            flex-wrap: wrap;\n";
    str += "            justify-content: center;\n";
    str += "            align-items: center;\n";
    str += "            align-content: center;\n";
    str += "            max-width:785px;\n";
    str += "        }\n";
    str += "        section {\n";
    str += "            border: var(--borderwidth) solid;\n";
    str += "            display:flex;\n";
    str += "            flex-wrap: wrap;\n";
    str += "            gap:10px;\n";
    str += "            justify-content: center;\n";
    str += "            align-items: center;\n";
    str += "            align-content: center;\n";
    str += "        }\n";
    str += "        #buttons{\n";
    str += "            border-color: red;\n";
    str += "        }\n";
    str += "        #states{\n";
    str += "            border-color: goldenrod;\n";
    str += "        } \n";
    str += "        footer {\n";
    str += "            border: var(--borderwidth) solid blue;\n";
    str += "            color: #777; \n";
    str += "            font-size:12px; \n";
    str += "            text-align: center;\n";
    str += "            width:var(--headFoot);\n";
    str += "            padding-top:10px;\n";
    str += "        }\n";
    str += "        .box{\n";
    str += "            border: var(--borderwidth) solid;\n";
    str += "            display:flex;\n";
    str += "            flex-direction: column;\n";
    str += "            justify-content: center;\n";
    str += "            align-items: center;\n";
    str += "        }\n";
    str += "        .controlPanel {\n";
    str += "            border: var(--borderwidth) solid blue;\n";
    str += "            display: flex;\n";
    str += "            flex-direction: column;\n";
    str += "            flex-wrap: wrap;\n";
    str += "            justify-content: center;\n";
    str += "            align-items: center;\n";
    str += "        }\n";
    str += "        .controlBlock{\n";
    str += "            border:var(--borderwidth) solid black;\n";
    str += "            display: flex;\n";
    str += "            flex-direction: row;\n";
    str += "            flex-wrap: wrap;\n";
    str += "            justify-content: space-evenly;\n";
    str += "            align-items: center;\n";
    str += "        }\n";
    str += "        .statePanel{\n";
    str += "            border: var(--borderwidth) solid red;\n";
    str += "            display:flex;\n";
    str += "            flex-direction: column;\n";
    str += "            flex-wrap: wrap;\n";
    str += "            justify-content: center;\n";
    str += "            align-items: center;\n";
    str += "        }\n";
    str += "        .panel{\n";
    str += "            border: var(--borderwidth) solid orange;\n";
    str += "            display: flex;\n";
    str += "            flex-direction: row;\n";
    str += "            flex-wrap:wrap;\n";
    str += "            justify-content: center;\n";
    str += "            align-items: center;\n";
    str += "        }\n";
    str += "\n";
    str += "        .stateBlock{\n";
    str += "            border: var(--borderwidth) solid green;\n";
    str += "            display:flex;\n";
    str += "            flex-direction: column;\n";
    str += "            justify-content: center;\n";
    str += "            align-items: center;\n";
    str += "        }\n";
    str += "        #buttonBox {\n";
    str += "            border: var(--borderwidth) solid yellow;\n";
    str += "        }\n";
    str += "        #stateBox {\n";
    str += "            border: var(--borderwidth) solid pink;\n";
    str += "            flex-direction: row;\n";
    str += "        }\n";
    str += "        .stateToggle{\n";
    str += "            padding: 10px 20px;\n";
    str += "            border-radius: 10px;\n";
    str += "            background-color: --;\n";
    str += "\n";
    str += "        }\n";
    str += "        button{\n";
    str += "            border:none;\n";
    str += "            cursor:pointer;\n";
    str += "        }\n";
    str += "        .buttonToggle{\n";
    str += "            padding: 10px 20px;\n";
    str += "            border-radius: 10px;\n";
    str += "            box-shadow: 0px 0px 5px 0px darkgoldenrod, 0px 0px 0px 5px black;\n";
    str += "            transition:transform .1s ease;\n";
    str += "        }\n";
    str += "        .buttonToggle:active{\n";
    str += "            transform:scale(0.8);\n";
    str += "        }\n";
    str += "        .buttonToggle.eStop{\n";
    str += "            padding: 0;\n";
    str += "            width: 80px;\n";
    str += "            height: 80px;\n";
    str += "            border-radius: 50%;\n";
    str += "        }\n";
    str += "        .buttonToggle.on{\n";
    str += "            background:var(--buttonRegOn);\n";
    str += "        }\n";
    str += "        .buttonToggle.off{\n";
    str += "            background:var(--buttonRegOff);\n";
    str += "        }\n";
    str += "        .buttonToggle.eStop.on{\n";
    str += "            background:var(--estopOn);\n";
    str += "        }\n";
    str += "        .buttonToggle.eStop.off{\n";
    str += "            background:var(--estopOff);\n";
    str += "        }\n";
    str += "        .buttonToggle.debugButton.off{\n";
    str += "            background: var(--buttonRegOff);\n";
    str += "        }\n";
    str += "        .buttonToggle.debugButton.on{\n";
    str += "            background: var(--buttonRegOn);\n";
    str += "        }\n";
    str += "        .idContainer{\n";
    str += "            border: var(--borderwidth) solid yellow;\n";
    str += "            display: flex;\n";
    str += "            flex-direction: column;\n";
    str += "            align-items: center;\n";
    str += "        }\n";
    str += "        .idBox{\n";
    str += "            border: var(--borderwidth) solid orange;\n";
    str += "            display:flex;\n";
    str += "            flex-direction: column;\n";
    str += "            align-items: flex-start;\n";
    str += "            gap:5px;\n";
    str += "        }\n";
    str += "        h5{\n";
    str += "            white-space:nowrap;\n";
    str += "            font-size:clamp(0.67em, 0.83em, 1em);\n";
    str += "        }\n";
    str += "        .trafficLight{\n";
    str += "            --S: clamp(0.5em, 4em, 5em);\n";
    str += "            width: var(--S);\n";
    str += "            padding: calc(var(--S) *0.12);\n";
    str += "            background:linear-gradient(#1a1a1a, #0e0e0e);\n";
    str += "            border: calc(var(--S) *0.014) solid #000;\n";
    str += "            border-radius: calc(var(--S)*0.12);\n";
    str += "            display:grid;\n";
    str += "            gap:calc(var(--S) * 0.11);\n";
    str += "            box-shadow: inset 0 calc(var(--S)*0.05) calc(var(--S)*0.09) rgba(255,255, 255, 0.05), inset 0 calc(var(--S)* -0.035) calc(var(--S)*0.10) rgba(0,0,0,0.60), 0 calc(var(--S)*0.07) calc(var(--S)*0.14) rgba(0,0,0,0.60);\n";
    str += "        }\n";
    str += "        .well {\n";
    str += "            background: linear-gradient(180deg, #0d0d0d 0%, #070707 100%);\n";
    str += "            padding:calc(var(--S) * 0.06);\n";
    str += "            border-radius:calc(var(--S)*0.10);\n";
    str += "            border:calc(var(--S)*0.08) solid #000;\n";
    str += "            box-shadow: inset 0 calc(var(--S)*0.06) calc(var(--S)*0.10) rgba(255, 255, 255, 0.06), inset 0 -calc(var(--S)* -0.08) calc(var(--S)*0.12) rgba(0,0,0,0.7);\n";
    str += "        }\n";
    str += "        .lamp {\n";
    str += "            width:inherit;\n";
    str += "            aspect-ratio: 1/1;\n";
    str += "            border-radius: 50%;\n";
    str += "            border: calc(var(--S) * 0.03) solid #000;\n";
    str += "            position: relative;\n";
    str += "            background: radial-gradient(160% 120% at 30% 30%, rgba(255, 255, 255, 0.18) 0%, transparent 35%), var(--baseColor, #222);\n";
    str += "            box-shadow: inset 0 calc(var(--S) *0.07) calc(var(--S)*0.12) rgba(255, 255, 255, 0.06), inset 0 calc(var(--S)*0.10) calc(var(--S)*0.14) rgba(0,0,0,0.45);\n";
    str += "            transition: box-shadow 140ms ease, background-color 140ms ease, filter 140ms ease;\n";
    str += "        }\n";
    str += "        .lamp.off {\n";
    str += "            filter: saturate(0.85) brightness(0.75);\n";
    str += "            box-shadow: inset 0 0 8px rgba(0,0,0,0.8);\n";
    str += "        }\n";
    str += "        .lamp.on.red {\n";
    str += "            --baseColor: var(--trafficRedOn);\n";
    str += "            background-color: var(--baseColor);\n";
    str += "            box-shadow: 0 0 calc(var(--S) * 0.14) calc(var(--S) * 0.03) var(--baseColor), \n";
    str += "                        0 0 calc(var(--S) * 0.30) calc(var(--S) * 0.06) var(--baseColor),\n";
    str += "                        inset 0 calc(var(--S) * 0.07) calc(var(--S) * 0.12) rgba(255, 255, 255, 0.06), \n";
    str += "                        inset 0 calc(var(--S) * 0.10) calc(var(--S) * 0.14) rgba(0, 0, 0, 0.45);\n";
    str += "        }\n";
    str += "        .lamp.off.red {\n";
    str += "            --baseColor: var(--trafficRedOff);\n";
    str += "        }\n";
    str += "        .lamp.on.yellow {\n";
    str += "            --baseColor: var(--trafficYellowOn);\n";
    str += "            background-color: var(--baseColor);\n";
    str += "            box-shadow: 0 0 calc(var(--S) * 0.14) calc(var(--S) * 0.03) var(--baseColor), \n";
    str += "                        0 0 calc(var(--S) * 0.30) calc(var(--S) * 0.06) var(--baseColor),\n";
    str += "                        inset 0 calc(var(--S) * 0.07) calc(var(--S) * 0.12) rgba(255, 255, 255, 0.06), \n";
    str += "                        inset 0 calc(var(--S) * 0.10) calc(var(--S) * 0.14) rgba(0, 0, 0, 0.45);\n";
    str += "        }\n";
    str += "        .lamp.off.yellow {\n";
    str += "            --baseColor: var(--trafficYellowOff);\n";
    str += "        }\n";
    str += "        .lamp.on.green {\n";
    str += "            --baseColor: var(--trafficGreenOn);\n";
    str += "            background-color: var(--baseColor);\n";
    str += "            box-shadow: 0 0 calc(var(--S) * 0.14) calc(var(--S) * 0.03) var(--baseColor), \n";
    str += "                        0 0 calc(var(--S) * 0.30) calc(var(--S) * 0.06) var(--baseColor),\n";
    str += "                        inset 0 calc(var(--S) * 0.07) calc(var(--S) * 0.12) rgba(255, 255, 255, 0.06), \n";
    str += "                        inset 0 calc(var(--S) * 0.10) calc(var(--S) * 0.14) rgba(0, 0, 0, 0.45);\n";
    str += "        }\n";
    str += "        .lamp.off.green {\n";
    str += "            --baseColor: var(--trafficGreenOff);\n";
    str += "        }\n";
    str += "        .stateGrid{\n";
    str += "            border:var(--borderwidth) solid yellow;\n";
    str += "            gap:10px;\n";
    str += "            display:grid;\n";
    str += "            grid-template-columns: repeat(4, 1fr);\n";
    str += "        }\n";
    str += "        .stateCell{\n";
    str += "            text-align: center;\n";
    str += "            padding:16px 8px;\n";
    str += "            border-radius: 8px;\n";
    str += "            background-color: var(--stateDefault);\n";
    str += "            font-weight: bold;\n";
    str += "            color: var(--textColourDefault);\n";
    str += "            box-shadow: 0 2px 4px rgba(0,0,0,0.1);\n";
    str += "            transition:background-color 0.3s ease;\n";
    str += "            font-size: 14px;\n";
    str += "            place-content: center;\n";
    str += "        }\n";
    str += "        .status{\n";
    str += "            color:var(--textColourDefault);\n";
    str += "        }\n";
    str += "    </style>\n";
    str += "    <script>\n";
    str += "        window.onload = function() {\n";
    str += "            const state = {\n";
    str += "                eStopBtn:           0,\n";
    str += "                debugBtn:           0,\n";
    str += "                stateSwitchBtn:     0,\n";
    str += "                activateBridgeBtn:  0,\n";
    str += "                photoCellState:     0,\n";
    str += "                sonicState:         0,\n";
    str += "                trafficLightState:  0,\n";
    str += "                bridgeState:        1,\n";
    str += "                nextState:          'Next State',\n";
    str += "            }\n";
    str += "\n";
    str += "            const traffic = {\n";
    str += "                red: document.getElementById('redTraffic'),\n";
    str += "                yellow: document.getElementById('yellowTraffic'),\n";
    str += "                green: document.getElementById('greenTraffic'),\n";
    str += "            }\n";
    str += "\n";
    str += "\n";
    str += "            function on(v) {return v === 1 || v === \"1\" || v === true;}\n";
    str += "            function setBtn(btn, onState, changeText) {\n";
    str += "                btn.classList.toggle('on', onState);\n";
    str += "                btn.classList.toggle('off', !onState);\n";
    str += "                btn.textContent = changeText ? onState?'Active':'InActive':btn.textContent;\n";
    str += "                btn.setAttribute('aria-pressed', onState ? 'true' : 'false');\n";
    str += "            }\n";
    str += "            function setBtnDisable(btn, onState, changeText) {\n";
    str += "                btn.classList.toggle('on', onState);\n";
    str += "                btn.classList.toggle('off', !onState);\n";
    str += "                btn.textContent = changeText ? onState?'Active':'InActive':btn.textContent;\n";
    str += "                btn.setAttribute('aria-pressed', onState ? 'true' : 'false');\n";
    str += "                if (btn.getAttribute('aria-pressed')===false) btn.disabled = true;\n";
    str += "            }\n";
    str += "            function setStateBox(el, onState) {\n";
    str += "                el.classList.toggle('on', onState);\n";
    str += "                el.classList.toggle('off', !onState);\n";
    str += "            }\n";
    str += "            function setTrafficLight(state) {\n";
    str += "                allOff();\n";
    str += "                switch(state) {\n";
    str += "                    case 0: setOn(red);\n";
    str += "                    case 1: setOn(yellow);\n";
    str += "                    case 2: setOn(green);\n";
    str += "                }\n";
    str += "            }\n";
    str += "            function allOff() {\n";
    str += "                traffic.forEach(el => {\n";
    str += "                    el.classList.remove('on');\n";
    str += "                    el.classList.setAttribute('aria-label', \n";
    str += "                        el.classList.contains('red)') ? 'Red light off' \n";
    str += "                            : el.classList.contains('yellow') ? 'Yellow light off' : 'Green light off'\n";
    str += "                    );\n";
    str += "                });\n";
    str += "            }\n";
    str += "            function setOn(el) {\n";
    str += "                el.classList.remove('off');\n";
    str += "                el.classList.add('on');\n";
    str += "                const c = el.classList.contains('red)') ? 'Red light off' : \n";
    str += "                            el.classList.contains('yellow') ? 'Yellow light off' : 'Green light off';\n";
    str += "                el.classList.setAttribute('aria-label', `${c} light on`);\n";
    str += "            }\n";
    str += "\n";
    str += "            function setActiveState(stateNum) {\n";
    str += "                for (let i = 1; i<=8;i++) {\n";
    str += "                    const cell = document.getElementById(`state-${i}`);\n";
    str += "                    cell.classList.toggle('active', i === stateNum);\n";
    str += "                }\n";
    str += "            }\n";
    str += "            function renderStatus() {\n";
    str += "                document.getElementById('status').textContent = `Status: { eStopBtn: ${state.eStopBtn}, debugBtn: ${state.debugBtn}, stateSwitchBtn: ${state.stateSwitchBtn}, activateBridgeBtn: ${state.activateBridgeBtn}, photoCellState: ${state.photoCellState}, sonicState: ${state.sonicState}, trafficLightState: ${state.trafficLightState}, bridgeState: ${state.bridgeState}, nextState: ${state.nextState}  }`\n";
    str += "            }\n";
    str += "\n";
    str += "            function poll() {\n";
    str += "                fetch('/state')\n";
    str += "                .then(r=>r.json())\n";
    str += "                .then(applyState)\n";
    str += "                .catch(()=>{});\n";
    str += "            }\n";
    str += "\n";
    str += "            function applyState(s) {\n";
    str += "                setBtnDisable(document.getElementById('eStopBtn'), on(s.eStopBtn));\n";
    str += "                setBtn(document.getElementById('debugBtn'), on(s.debugBtn));\n";
    str += "                setBtn(document.getElementById('stateSwitchBtn'), state(s.stateSwitchBtn));\n";
    str += "                setBtn(document.getElementById('activateBridgeBtn'), on(s.activateBridgeBtn));\n";
    str += "                setStateBox(document.getElementById('photoCellState'), on(s.photoCellState));\n";
    str += "                setStateBox(document.getElementById('sonicState'), on(sonicState));\n";
    str += "                setTrafficLight(parseInt(s.trafficLightState));\n";
    str += "                setActiveState(parseInt(s.bridgeState));\n";
    str += "                document.getElementById('stateSwitchBtn').textContent = s.nextState || 'Next State';\n";
    str += "                renderStatus;\n";
    str += "            }\n";
    str += "\n";
    str += "            document.getElementById('eStopBtn').addEventListener('click', () => {\n";
    str += "                state.eStopBtn = state.eStopBtn ? 0 : 1;\n";
    str += "                fetch(state.eStopBtn ? '/eStop/on' : '/eStop/off');\n";
    str += "                renderStatus();\n";
    str += "            });\n";
    str += "\n";
    str += "            document.getElementById('debugBtn').addEventListener('click', () => {\n";
    str += "                state.debugBtn = state.debugBtn ? 0 : 1;\n";
    str += "                fetch(state.debugBtn ? '/debug/on' : '/debug/off');\n";
    str += "                renderStatus();\n";
    str += "            });\n";
    str += "\n";
    str += "            document.getElementById('stateSwitchBtn').addEventListener('click', () => {\n";
    str += "                state.stateSwitchBtn = state.stateSwitchBtn === 8 ? 1:state.stateSwitchBtn+1;\n";
    str += "                fetch('/switchState');\n";
    str += "                renderStatus();\n";
    str += "            });\n";
    str += "\n";
    str += "            document.getElementById('activateBridgeBtn').addEventListener('click', () => {\n";
    str += "                state.activateBridgeBtn = state.activateBridgeBtn ? 0 : 1;\n";
    str += "                fetch(state.activateBridgeBtn ? '/activateBridge/raise' : '/activateBridge/lower');\n";
    str += "                renderStatus();\n";
    str += "            });\n";
    str += "\n";
    str += "            // poll();\n";
    str += "            // setInterval(poll, 1000);\n";
    str += "        }\n";
    str += "\n";
    str += "    </script>\n";
    str += "</head>\n";
    str += "<body>\n";
    str += "    <header>\n";
    str += "        <div class=\"title\">\n";
    str += "            <h1> Team WA8 Single Leaf Bridge </h1>\n";
    str += "            <h2> Wireless Control Panel </h2>\n";
    str += "        </div>\n";
    str += "    </header>\n";
    str += "    <main> \n";
    str += "        <div class=\"sideBar\">\n";
    str += "            <div class=\"controlBlock\">\n";
    str += "                <div class=\"box\" id=\"buttonBox\"> \n";
    str += "                    <label for=\"eStopBtn\" class=\"controlLabel\"> Emergency Stop </label>\n";
    str += "                    <button id=\"eStopBtn\" class=\"buttonToggle eStop on\" aria-pressed=\"false\" > OFF </button>\n";
    str += "                </div>\n";
    str += "            </div>\n";
    str += "            <div class=\"controlBlock\">\n";
    str += "                <div class=\"box\" id=\"buttonBox\"> \n";
    str += "                    <label for=\"debugBtn\" class=\"controlLabel\"> Debug Mode </label>\n";
    str += "                    <button id=\"debugBtn\" class=\"buttonToggle debug on\" aria-pressed=\"false\" > OFF </button>\n";
    str += "                </div>\n";
    str += "            </div>\n";
    str += "            <div class=\"idContainer\">\n";
    str += "                <div class=\"idContainer\">\n";
    str += "                    <h4>Systems: Group 88</h4>\n";
    str += "                    <div class=\"idBox\">\n";
    str += "                        <h5>48253383 : Isabelle Farolan</h5>\n";
    str += "                        <h5>48346992 : Brie McWhirter</h5>\n";
    str += "                        <h5>47881453 : Nicholas Greenhouse</h5>\n";
    str += "                        <h5>48074101 : Rikita Shil</h5>\n";
    str += "                        <h5>47727330 : Christopher Stokan</h5>\n";
    str += "                        <h5>47713623 : Aidan Williams</h5>\n";
    str += "                        <h5>48275778 : Caleb Chew</h5>\n";
    str += "                    </div>\n";
    str += "                </div>\n";
    str += "                <div class=\"idContainer\">\n";
    str += "                    <h4>Structures: Group 73</h4>\n";
    str += "                    <div class=\"idBox\">\n";
    str += "                        <h5>47286091 : Adam Malvern</h5>\n";
    str += "                        <h5>46375929 : Harry Vale</h5>\n";
    str += "                        <h5>48347582 : Mohammad Haider</h5>\n";
    str += "                        <h5>47408456 : Bailey Kee</h5>\n";
    str += "                        <h5>47666412 : Adam Ruiz Diaz</h5>\n";
    str += "                        <h5>46387897 : Michael Ferlauto</h5>\n";
    str += "                        <h5>48096695 : Hasanuzzaman Shoeb</h5>\n";
    str += "                    </div>\n";
    str += "                </div>\n";
    str += "            </div>\n";
    str += "        </div>\n";
    str += "        <div class=\"mainBlock\">\n";
    str += "            <section id=\"buttons\">\n";
    str += "                <div class=\"panel\">\n";
    str += "                    <div class=\"controlPanel\">\n";
    str += "                        <h3>Manual Controls</h3>\n";
    str += "                        <div class=\"controlBlock\">\n";
    str += "                            <div class=\"box\" id=\"buttonBox\"> \n";
    str += "                                <label for=\"stateSwitchBtn\" class=\"controlLabel\"> Next State </label>\n";
    str += "                                <button id=\"stateSwitchBtn\" class=\"buttonToggle off\" aria-pressed=\"false\" > State </button>\n";
    str += "                            </div>\n";
    str += "                            <div class=\"box\" id=\"buttonBox\"> \n";
    str += "                                <label for=\"activateBridgeBtn\" class=\"controlLabel\"> Activate Bridge </label>\n";
    str += "                                <button id=\"activateBridgeBtn\" class=\"buttonToggle off\" aria-pressed=\"false\" > Still </button>\n";
    str += "                            </div>\n";
    str += "                        </div>\n";
    str += "                    </div>\n";
    str += "                    <div class=\"statePanel\">\n";
    str += "                        <h3>Sensor States</h3>\n";
    str += "                        <div class=\"box\" id=\"stateBox\">\n";
    str += "                            <div>\n";
    str += "                                <label> Photocell Sensor </label>\n";
    str += "                                <div id=\"photoCellState\" class=\"stateCell\">Not Detected</div>\n";
    str += "                            </div>\n";
    str += "                            <div>\n";
    str += "                                <label> UltraSonic Sensor </label>\n";
    str += "                                <div id=\"sonicState\" class=\"stateCell\">Not Detected</div>\n";
    str += "                            </div>\n";
    str += "                        </div>\n";
    str += "                    </div>\n";
    str += "                </div>\n";
    str += "                <div class=\"statePanel traffic\">\n";
    str += "                    <h3>Traffic System Panel</h3>\n";
    str += "                    <div class=\"stateBlock\">\n";
    str += "                        <div class=\"trafficLight\">\n";
    str += "                            <div class=\"well\">\n";
    str += "                                <div id=\"redTraffic\" class=\"lamp on red\" role=\"img\" aria-label=\"Red light on\"></div>\n";
    str += "                            </div>\n";
    str += "                            <div class=\"well\">\n";
    str += "                                <div id=\"yellowTraffic\" class=\"lamp off yellow\" role=\"img\" aria-label=\"Yellow light on\"></div>\n";
    str += "                            </div>\n";
    str += "                            <div class=\"well\">\n";
    str += "                                <div id=\"greenTraffic\" class=\"lamp off green\" role=\"img\" aria-label=\"Green light on\"></div>\n";
    str += "                            </div>\n";
    str += "                        </div>\n";
    str += "                    </div>\n";
    str += "                </div>\n";
    str += "            </section>\n";
    str += "            <section id=\"states\">\n";
    str += "                <div class=\"statePanel\">\n";
    str += "                    <h3>Bridge State Panel</h3>\n";
    str += "                    <div class=\"stateGrid\">\n";
    str += "                        <div id=\"state-1\" class=\"stateCell\"><h4>Lowered</h4></div>\n";
    str += "                        <div id=\"state-2\" class=\"stateCell\"><h4>Prepare Raise</h4></div>\n";
    str += "                        <div id=\"state-3\" class=\"stateCell\"><h4>Raising</h4></div>\n";
    str += "                        <div id=\"state-4\" class=\"stateCell\"><h4>Raised</h4></div>\n";
    str += "                        <div id=\"state-5\" class=\"stateCell\"><h4>Prepare Lower</h4></div>\n";
    str += "                        <div id=\"state-6\" class=\"stateCell\"><h4>Lowering</h4></div>\n";
    str += "                        <div id=\"state-7\" class=\"stateCell\"><h4>Emergency Lower</h4></div>\n";
    str += "                        <div id=\"state-8\" class=\"stateCell\"><h4>Emergency Raise</h4></div>\n";
    str += "\n";
    str += "                    </div>\n";
    str += "                </div>\n";
    str += "            </section>\n";
    str += "        </div>        \n";
    str += "    </main>\n";
    str += "    <section>\n";
    str += "        <div class=\"status\">\n";
    str += "            <div class=\"status\">Status: {</div>\n";
    str += "            <div class=\"status\">eStopBtn: 0, debugBtn: 0, stateSwitchBtn: 0</div>\n";
    str += "            <div class=\"status\">photoCellState: 0, sonicState: 0, activateBridgeBtn: 0</div>\n";
    str += "            <div class=\"status\">trafficLightState: 0, bridgeState: 1, nextState: Next State }</div>\n";
    str += "        </div>\n";
    str += "    </section>\n";
    str += "    <footer>\n";
    str += "        <p>Team WA8 Wifi Control Web-Based GUI for AP Access to the ESP32 Microcontroller for Controller over subsystems of the ENGG2000/3000 Scale Model Bridge Design/Contruction Project</p>\n";
    str += "        <a href=\"https://github.com/ChewOnThis/e2k-e3k-systems\" target=\"_blank\">GitHub Repository</a>\n";
    str += "    </footer>\n";
    str += "</body>\n";
    str += "</html>\n";
    return str;
}
